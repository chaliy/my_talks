# Інтро

1. Моя боротьба 

> Мене давно збуджувала назва MapReduce, а от зрозуміти що це і навіщо воно мені потрібно я довго не міг.
> Теоретично моя доповідь розрахована на приблизно таку людину: чув про MapReduce, щось читав. Цілком можливо що після моєї доповді нічого так і не стане зрозуміло ;), коротше якщо що питайте, якщо вам сдалється що якусь частину ви розумієте краще, кажіть.
> І я майже не слова не розповім про реалізації МапРедьюс

2. Результат

> Теоретично зрозуміти що то є, навіщо воно потрібно і як користуватись
> Знати де шукати, де читати, що не читати, де не шукати
> Подивитись хто і як використовує цю штуку

# Теорія

> Якщо хтось цікавився, то мабуть знає що Гугль в якомусь році опублікував статтю про МапРедьюс, і з тих пір про цю штуку всі жужжать. Так от, мені анітрохи, та стаття не допомгла, приклад з рахуванням слів просто не працює в моєму уявленні
> Також є стаття де пояснюється MapReduce на прикладі MongoDb, там основна проблема то JavaScript, для мене той самий вихлоп, я того не розумію
> Для мене прорив був коли я нафігачив с десяток МапРедьюсів для РавенДБ. Тільки після цього я почав розуміти МапРедьюс, а потім пішло і поїхало, коцепція дуже легка, і стає зрозумілим і рахування слів, і джаваскрипт, і навіщо воно в загалі потрібно. Ну і на додачу в неділю я почав читати NoSQL Distilled :)
> Отже я спробую розповісти про MapReduce на прикладі майже реального і дуже схожего на той що я маю в реальній ситемі запиту. Для цього мені потрібена невеличка модель. Будуть данні продаж. Задача отримати звіт по кварталах.

# Приклад

Продаж -> Звіт

1. Невеличкий екскурс Aggregate Data Models на противагу Реляційним Дата Моделям (NoSQL Distilled)
2. Продажів зрозуміло дуже багато, використовується шардінг

# Загальне рішення

1. Завдання можно вирішити SQL, едине чому я вставив сюди цей код, щоб було зрозуміло що той звіт робить. Я потім ще повернусь до порівняння з SQL
2. А ось для розуміння нам краще підійде реалізація простим foreach

# Від foreach до небес…

1. Цей foreach просто чудовоий, але в нього є декілька проблема
  - все в пам'яті, у нас дуже багато данних
  - все в одному потоці, погано ж
  - все на одному диханні, якщо така штука працю 8 годин, то э проблема ;)
  Проблема проста, ми просто не влазимо по ресрусах.
2. Проблема проста, і решення просте, нам просто потрібно поділити работу на невеличкі шматочки.
  - насправді код робить дві речі, ВитгаєДанні а потім їх Агрегує. 
  - це нас дуже влаштовує, адже ми можемо поділити виконання на дві частини.
3. На справді це і є сестри Map і Reduce
  - Мап насправді може приймати і один елемент, але приймаючи колекцію і повертаючи колекцію, сігнатура фінкції стає більш загальна, ну і плюс деякі операції краще робити в батчах
  - З Редьюсом все дещо складніше, я не зміг вигатади як його легко написати, він просто агрегує данні
  - А ось тепер найголовніше. Все те що біло сірим може зробити інраструктура. А там вже відкриваються вже дуже великі можливості.

# Небеса

1. Пам'ять, тут все зрозуміло, розмір потрібної пам'яті повністю контролюється
2. Паралельна обробка. Без питань. Оби два Мап і Редьюс можуть виконуватись паралельно, більше того якщо навіть всі Мапи ще не закінчились, теоретично можно починати виконувати Редьюси
3. Шардінг, все без проблем розкидається по нодах, бліьше того і данні можуть збиратися з різних нод
4. Данні між Мапами і Редьюсами можна зберігати(кешувати), тоді наприклад якщо додався один документ, то можна зробити Мап тільки для нього, і перепрогнати тільки Редьюси.
5. __Scalability (Масштабовність)__, якщо по простому, то роботу можно розбити на маленькі шматочки, і виконвути її будь де і яким завгодно способом. А це означає майже лінійну маштабованість.

# Клей (Інфраструктура)

1. Це остання штука потрібна для розуміння, якщо наприклад взяти в майже будь яку документно орієнтовану БД, то документи вже там.
2. Важилиов розуміти що, на кожному етапі будь який хост для МапРдьюс спробую мінімізувати затрати на виконання. Так наприклад Хадуп ніколи не показують у вигляді двох кубиків Мап та Редьюс, між Мап і Редьюс ще втикають Кобайнери, Партішенери і Шаффле енд Сорт.

# Юзкейси

1. Звіти - це приклад який навів, це мабуть найпоширений 
2. Розподілене виконання завданнь - Мап може не тільки вигрібати цікаві данні, воно може ще робити щось ресурсоємне, ну Редьюс вже будет просто для отрмання результатів
3. Індексація - дуже схоже на звіти, але майже не використовується редьюс, може також фільтрувати

Епічна стаття - http://highlyscalable.wordpress.com/2012/02/01/mapreduce-patterns/

# Проблеми

1. Не швидкий
2. Є речі які слкдано зробити, наприклад Average, Сортування(в Хадупі все просто), бігання по деревах
3. А є речі неможливі

NoSQL Distilled